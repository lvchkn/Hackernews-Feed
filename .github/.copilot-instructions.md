# Copilot Instructions

## Project Overview
This repository contains a **.NET** service called `Hackernews-Feed` written in **C#**.

The purpose of this service is to act as a proxy backend for a custom SPA client.  

- `Feed` retrieves stories published on the Hackernews website, processes them and exposes REST API endpoints for the client to use.

- `Feed` stores the stories in a Postgres database and allows filtering, sorting, paging, ranking and tagging them.

- `Feed` uses Github OAuth2 for user authentication

- On startup `Feed` spins up a background worker that polls a `RabbitMQ` queue for new Hackernews stories (published by another microservice).

- `Feed` allows each user to add their own interests to follow the topics that want to see in their feed

- `Feed` has a set of tags automatically applied to stories based on keywords

It is structured into the following layers:

- **Api** - Minimal API-style REST API controllers, IoC container configuration, middleware
- **Application** - Services that define logic for interaction with data layer, filtering, sorting, paging, ranking and tagging stories
- **Infrastructure** - EF Core repositories, `DbContext`, filter and sort implementations. `RabbitMQ` worker for reading incoming stories from a queue
- **Domain** - Domain entities (Story, Interest, Tag, User)
- **Shared** - Reusable custom exception definitions and constants
- **Tests** - Unit and integration tests

Concurrency, async programming, immutability, and DI best practices are followed.

---
## Coding Conventions
- Use **the latest version of C#**, **nullable reference types**, and **async/await** when possible.
- Follow **.NET style guidelines**:
    - `PascalCase` for public members.
    - `camelCase` for locals and parameters.
    - Prefix private readonly fields with `_`.
- Favor **records** for immutable DTOs and **classes** for entities.
- Avoid unnecessary abstractions (“you aren’t gonna need it” principle).
- Use **dependency injection** instead of statics or singletons.
- Use minimal API style rather than full-fledged controllers
- Use manually defined mapping extensions from the `Application/Mappers`

---
## Testing & Quality
- Use **xUnit** as the testing framework for everything, including assertions.
- Mock dependencies using **NSubstitute** when necessary
- Prefer testing behavior and domain logic, not implementation details
- Write unit tests for pure functions, prefer integration tests (`WebApplicationFactory`-based + `testcontainers`) for more complex scenarios

---
## Copilot-Specific Guidance
When generating or editing code, Copilot should:
- **Follow existing folder structure and DI patterns**.
- **Favor readability** and **consistency** over cleverness.
- Suggest **small, focused methods** and **self-documenting names**.
- Avoid re-implementing existing helper methods or frameworks.
- When unsure, prefer idiomatic .NET patterns.

If asked to:
- **Add a feature** → create DTOs, handlers, and endpoints following existing conventions.
- **Fix a bug** → prefer minimal, clear fixes that maintain current design.
- **Write tests** → ensure Arrange-Act-Assert structure and expressive assertions.
- **Document** → write XML comments for public APIs and summarize intent clearly.

---
## Dependencies

- **Entity Framework Core** as an ORM
- **Npgsql** as the Postgres driver
- **RabbitMQ** for reading the stories that can be consumed by other services
- **Swagger / Swashbuckle** for API docs
- **Xunit** as the testing framework
- **Testcontainers** for integration testing external services via Docker containers
- **Docker Compose** for orchestration and deployment
- **Nginx** as reverse-proxy

---